(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{118:function(e,t,a){e.exports=a(164)},164:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(29),s=a.n(l),c=a(115),o=a(116),i=a(12),u=a(93),m=a(94),h=a(114),p=a(95),d=a(117),E=a(113),f=a.n(E),v=a(24),y=a.n(v),g=a(39),j=a.n(g),k=a(13),b=a.n(k),C=a(78),O=a.n(C),w=a(62),S=a.n(w),D=a(77),T=a.n(D),A=a(35),Y=a.n(A),M=a(96),P=a(73),_=a(75),K=a(76),B=a.n(K),I=(a(133),a(134),function(e){function t(){var e;return Object(u.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this))).state={step:0,apiKey:null,kronosEmail:"",kronosPassword:"",month:null,participeData:[],logData:new Map,sums:{proj:0,acc:0,playlist:0,projreg:0},loadingConnect:!1,loadingDatas:!1,connectError:null,fetchError:null,datasToFetch:"participe"},e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"emailChange",value:function(e){this.setState(Object(i.a)({},this.state,{kronosEmail:e.target.value}))}},{key:"passwordChange",value:function(e){this.setState(Object(i.a)({},this.state,{kronosPassword:e.target.value}))}},{key:"getApiKey",value:function(){var e=this;this.setState(Object(i.a)({},this.state,{loadingConnect:!0,connectError:null}),function(){return fetch("https://api-kronos.ticketack.com/kuser/login",{method:"POST",headers:{"Content-Type":"application/json",Referer:"https://kronos.ticketack.com/"},body:JSON.stringify({email:e.state.kronosEmail,password:e.state.kronosPassword})}).then(function(e){return e.json()}).then(function(t){t.flash.error?e.setState(Object(i.a)({},e.state,{connectError:t.flash.error})):e.setState(Object(i.a)({},e.state,{step:1,apiKey:t.user.api_key}))}).finally(function(){e.setState(Object(i.a)({},e.state,{loadingConnect:!1}))})})}},{key:"handleChangeMonth",value:function(e){this.setState(Object(i.a)({},this.state,{step:2,month:e}))}},{key:"datasToFetchChange",value:function(e){this.setState(Object(i.a)({},this.state,{datasToFetch:e.currentTarget.value}))}},{key:"fetchDatas",value:function(){var e=this,t=B()(this.state.month),a=B()(this.state.month).endOf("month");this.setState(Object(i.a)({},this.state,{loadingDatas:!0,fetchError:null}),function(){"participe"===e.state.datasToFetch?fetch("https://api-kronos.ticketack.com/task/list?start_at_gte=".concat(t.format("YYYY-MM-DDTHH:mm:ssZ").replace("+","%2B"),"&start_at_lte=").concat(a.format("YYYY-MM-DDTHH:mm:ssZ").replace("+","%2B")),{headers:{"Content-Type":"application/json",Referer:"https://kronos.ticketack.com/","X-API-Key":e.state.apiKey}}).then(function(e){return e.json()}).then(function(t){if(t.flash.error)e.setState(Object(i.a)({},e.state,{fetchError:t.flash.error}));else{var a=t.tasks,n=new Set;a.forEach(function(e){e.user&&n.add("".concat(e.user.firstname," ").concat(e.user.lastname))});var r=[],l={proj:0,acc:0,playlist:0,projreg:0};n.forEach(function(e){var t=e.split(" "),n=Object(o.a)(t),s=n[0],c=n.slice(1),i={proj:0,acc:0,playlist:0,projreg:0};a.forEach(function(e){e.user&&e.user.firstname===s&&e.user.lastname===c.join(" ")&&("Accueil/billetterie"===e.activity.name.fr&&(i.acc++,l.acc++),"Projectionniste"===e.activity.name.fr&&(i.proj++,l.proj++),"Projectionniste-r\xe9gisseur"===e.activity.name.fr&&(i.projreg++,l.projreg++),"Playlister"===e.activity.name.fr&&(i.playlist+=3,l.playlist+=3))}),r.push({volunteer:e,proj:i.proj,acc:i.acc,projreg:i.projreg,playlist:i.playlist})});var s=r.sort(function(e,t){return e.volunteer<t.volunteer?-1:e.volunteer>t.volunteer?1:0});e.setState(Object(i.a)({},e.state,{step:3,participeData:s,sums:l}))}}).finally(function(){return e.setState(Object(i.a)({},e.state,{loadingDatas:!1}))}):fetch("https://api-kronos.ticketack.com/task/list?start_at_gte=".concat(t.format("YYYY-MM-DDTHH:mm:ssZ").replace("+","%2B"),"&start_at_lte=").concat(a.format("YYYY-MM-DDTHH:mm:ssZ").replace("+","%2B")),{headers:{"Content-Type":"application/json",Referer:"https://kronos.ticketack.com/","X-API-Key":e.state.apiKey}}).then(function(e){return e.json()}).then(function(t){if(t.flash.error)e.setState(Object(i.a)({},e.state,{fetchError:t.flash.error}));else{var a=t.tasks,n=new Map;a.forEach(function(e){if(null!=e.user){var t=n.has(e.start_at)?n.get(e.start_at):{volunteers:[]};t.volunteers.push({name:e.user.fullname,work:e.activity.name.fr}),n.set(e.start_at,t)}}),e.setState(Object(i.a)({},e.state,{step:3,logData:n}))}}).finally(function(){return e.setState(Object(i.a)({},e.state,{loadingDatas:!1}))})})}},{key:"convertArrayOfObjectsToCSV",value:function(e){var t=e.data||null;if(null==t||!t.length)return null;var a=e.columnDelimiter||",",n=e.lineDelimiter||"\n",r=Object.keys(t[0]),l="";return l+=r.join(a),l+=n,t.forEach(function(e){var t=0;r.forEach(function(n){t>0&&(l+=a),l+=e[n],t++}),l+=n}),l}},{key:"downloadCSV",value:function(e){var t=this.convertArrayOfObjectsToCSV({data:e});if(null!=t){t.match(/^data:text\/csv/i)||(t="data:text/csv;charset=utf-8,"+t);var a=encodeURI(t),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download","volunteer-data.csv"),n.click()}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Y.a,{bg:"dark",variant:"dark"},r.a.createElement(Y.a.Brand,{href:"#home"},"Kronos Volunteer Fetcher"),r.a.createElement(Y.a.Toggle,null),r.a.createElement(Y.a.Collapse,{className:"justify-content-end"},r.a.createElement(Y.a.Text,null,"Cin\xe9majoie"))),r.a.createElement(f.a,{className:"mt-4"},r.a.createElement(y.a,null,r.a.createElement(j.a,null,this.state.step>=0&&r.a.createElement("div",null,r.a.createElement(y.a,null,r.a.createElement("h3",null,"1. R\xe9cup\xe9rer la cl\xe9 d'API")),r.a.createElement(y.a,null,null!=this.state.connectError&&r.a.createElement(T.a,{variant:"danger"},this.state.connectError),r.a.createElement(b.a,null,r.a.createElement(b.a.Group,{controlId:"kronos-connect-email"},r.a.createElement(b.a.Label,null,"Adresse email Kronos"),r.a.createElement(b.a.Control,{type:"email",onChange:this.emailChange.bind(this)})),r.a.createElement(b.a.Group,{controlId:"kronos-connect-password"},r.a.createElement(b.a.Label,null,"Mot de passe Kronos"),r.a.createElement(b.a.Control,{type:"password",onChange:this.passwordChange.bind(this)})),r.a.createElement(S.a,{variant:"primary",onClick:this.getApiKey.bind(this),disabled:this.state.loadingConnect},this.state.loadingConnect?r.a.createElement(P.a,{icon:_.a,spin:!0}):"Se connecter"))))),r.a.createElement(j.a,null,this.state.step>=1&&r.a.createElement("div",null,r.a.createElement(y.a,null,r.a.createElement("h3",null,"2. S\xe9lection du mois")),r.a.createElement(y.a,null,null!=this.state.fetchError&&r.a.createElement(T.a,{variant:"danger"},this.state.fetchError),r.a.createElement(b.a,null,r.a.createElement(b.a.Group,{controlId:"fetch-date-start"},r.a.createElement(b.a.Label,null,"S\xe9lectionner le mois"),r.a.createElement("br",null),r.a.createElement(M.a,{selected:this.state.month,dateFormat:"MM/yyyy",showMonthYearPicker:!0,onChange:this.handleChangeMonth.bind(this)})))))),r.a.createElement(j.a,null,this.state.step>=2&&r.a.createElement("div",null,r.a.createElement(y.a,null,r.a.createElement("h3",null,"3. S\xe9lectionner donn\xe9es")),r.a.createElement(y.a,null,r.a.createElement(b.a,null,r.a.createElement(b.a.Group,{controlId:"select-datas"},r.a.createElement(b.a.Label,null,"Select datas to fetch"),r.a.createElement(b.a.Control,{as:"select",onChange:this.datasToFetchChange.bind(this)},r.a.createElement("option",{value:"participe"},"Participations"),r.a.createElement("option",{value:"log"},"Journal"))),r.a.createElement(S.a,{variant:"primary",onClick:this.fetchDatas.bind(this),disabled:this.state.loadingDatas},this.state.loadingWorks?r.a.createElement(P.a,{icon:_.a,spin:!0}):"Valider")))))),this.state.step>=3&&r.a.createElement("div",{className:"mt-4"},r.a.createElement(y.a,null,r.a.createElement("h3",null,"4. Affichage des donn\xe9es ",r.a.createElement(S.a,{onClick:function(){return e.downloadCSV(e.state.participeData)}},"Exporter en CSV"))),r.a.createElement(y.a,null,"participe"===this.state.datasToFetch?r.a.createElement(O.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"B\xe9n\xe9vole"),r.a.createElement("th",null,"Accueil/billetterie"),r.a.createElement("th",null,"Projection"),r.a.createElement("th",null,"Projection - R\xe9gie"),r.a.createElement("th",null,"Playlist"),r.a.createElement("th",null,"Billets"))),r.a.createElement("tbody",null,this.state.participeData.length>0&&this.state.participeData.map(function(e){return r.a.createElement("tr",{key:e.volunteer},r.a.createElement("td",null,e.volunteer),r.a.createElement("td",null,e.acc>0?e.acc:"-"),r.a.createElement("td",null,e.proj>0?e.proj:"-"),r.a.createElement("td",null,e.projreg>0?e.projreg:"-"),r.a.createElement("td",null,e.playlist>0?e.playlist:"-"),r.a.createElement("td",null,e.acc+e.proj+e.projreg+e.playlist))})),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Totaux")),r.a.createElement("td",null,this.state.sums.acc),r.a.createElement("td",null,this.state.sums.proj),r.a.createElement("td",null,this.state.sums.projreg),r.a.createElement("td",null,this.state.sums.playlist),r.a.createElement("td",null,this.state.sums.acc+this.state.sums.proj+this.state.sums.projreg+this.state.sums.playlist)))):r.a.createElement(O.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"S\xe9ance"),r.a.createElement("th",null,"B\xe9n\xe9vole"),r.a.createElement("th",null,"Poste"))),r.a.createElement("tbody",null,Array.from(this.state.logData).length>0&&Array.from(this.state.logData,function(e){var t=Object(c.a)(e,2),a=t[0],n=t[1].volunteers;return(Array.isArray(n)?n:[n]).map(function(e,t){return r.a.createElement("tr",{key:a+t},r.a.createElement("td",null,0===t?a:'"'),r.a.createElement("td",null,e.name),r.a.createElement("td",null,e.work))})})))))))}}]),t}(r.a.Component));a(162),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[118,1,2]]]);
//# sourceMappingURL=main.ed2c5e21.chunk.js.map